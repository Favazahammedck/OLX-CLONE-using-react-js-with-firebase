# require-auth
[![NPM version](https://img.shields.io/npm/v/require-auth.svg)](https://www.npmjs.com/package/require-auth)

Express middleware

## Pre

To fully use this package we need to validate a JSON Web Token (JWT)
<br>See https://auth0.com/docs/quickstart/backend/nodejs

We also need to add custom claims to your Access Token (or ID Token) using Auth0 Rules.
<br>See: https://auth0.com/docs/tokens/access-token#add-custom-claims

## Init
`require-auth` `init` must be run after a jwt token i validated.

In server.js
```js
const express = require('express');
const bodyParser = require('body-parser');
const app = express();
const requireAuth = require('require-auth');
//  See https://auth0.com/docs/quickstart/backend/nodejs
const jwtCheck = require('path/your-jwtCheck');

//  Before routes
app.use(jwtCheck);
//  In auth0 you can add metadata to your tokens
//  See https://auth0.com/docs/tokens/access-token#add-custom-claims

//  Add roles and permissions to request obj
app.use(requireAuth.init('https://yourNamespace.com'));

//  Rest of code
...
```

## Usage
Now we can use `require-auth` in our router file
```js
const express = require('express');
const router = express.Router();
const requireAuth = require('require-auth');

router.get('/users', requireAuth.permission('users:read'), (req, res) => {
  res.status(200).send("You have the users:read access!");
  return;
});

router.get('/users', requireAuth.role('admin'), (req, res) => {
  res.status(200).send("You have access through admin role!");
  return;
});
```
